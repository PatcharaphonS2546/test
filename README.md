# Gaze All-in-One — test.py

## รายละเอียดโปรแกรม
`test.py` เป็นโปรแกรมต้นแบบ (POC) สำหรับระบบติดตามสายตา (Gaze Tracking) และควบคุมเมาส์ด้วยสายตา โดยรวมทุกฟังก์ชันไว้ในไฟล์เดียว เหมาะสำหรับการศึกษา ทดลอง และพัฒนาเบื้องต้น

### ฟีเจอร์หลัก
- **Calibration**: ระบบคาลิเบรตสายตาโดยวาดจุดบนวิดีโอเฟรมแบบอินเทอร์แอคทีฟ ไม่ต้องรีเฟรชหน้าเว็บ
- **Progressive Points & Stabilizer**: รองรับการคำนวณจุดสายตาแบบต่อเนื่องและลดความสั่นไหว
- **Monolid/Unequal-eyes**: ปรับแต่งสำหรับลักษณะตาไม่เท่ากัน
- **Eye-first Weighted Ridge**: เทคนิคคำนวณตำแหน่งสายตาแบบถ่วงน้ำหนัก
- **Pointer Follow & Dwell Click**: เมาส์เคลื่อนตามสายตาและคลิกอัตโนมัติเมื่อจ้องนาน (dwell)
- **Click Gate**: ระบบปลดล็อกคลิกเมื่อผ่านเกณฑ์คาลิเบรต (RMSE/CV/Uniformity)

### ไลบรารีที่ใช้
- `streamlit`, `streamlit-webrtc`: สร้าง UI และจัดการวิดีโอสตรีม
- `opencv-python`, `mediapipe`, `av`, `numpy`: ประมวลผลภาพและวิดีโอ, ตรวจจับใบหน้า/ดวงตา
- `pyautogui` (ไม่บังคับ): ควบคุมเมาส์จริงบนระบบปฏิบัติการ

### โครงสร้างการทำงาน
1. **เริ่มต้นโปรแกรม**: รันผ่าน Streamlit เพื่อเปิดเว็บแอป
2. **Webcam Video Stream**: รับภาพจากกล้องผ่าน `streamlit-webrtc` และประมวลผลด้วย OpenCV/Mediapipe
3. **Calibration**: ผู้ใช้จ้องจุดที่ปรากฏบนหน้าจอเพื่อคาลิเบรตระบบ
4. **Gaze Estimation**: ประมวลผลตำแหน่งสายตาแบบเรียลไทม์และกรองสัญญาณด้วย One Euro Filter
5. **Mouse Control**: เคลื่อนเมาส์ตามตำแหน่งสายตา (ถ้าติดตั้ง pyautogui) และคลิกเมื่อจ้องนาน
6. **ประเมินผลคาลิเบรต**: แสดงค่าความแม่นยำและปลดล็อกการคลิกเมื่อผ่านเกณฑ์

## วิธีตั้งค่าและใช้งาน

### 1. เตรียม Python Environment
- แนะนำให้ใช้ Python 3.10 ขึ้นไป
- สร้าง virtual environment (ถ้าต้องการ)
  ```
  python -m venv venv
  venv\Scripts\activate
  ```

### 2. ติดตั้งไลบรารีที่จำเป็น
- ติดตั้ง dependencies จากไฟล์ `requirements.txt`
  ```
  pip install -r requirements.txt
  ```
- หากต้องการควบคุมเมาส์จริง ติดตั้งเพิ่ม:
  ```
  pip install pyautogui
  ```

### 3. ตรวจสอบกล้อง Webcam
- เชื่อมต่อกล้องกับคอมพิวเตอร์ให้พร้อมใช้งาน
- ทดสอบกล้องด้วยโปรแกรมอื่นก่อน (เช่น Camera app)

### 4. รันโปรแกรม
- เปิดเทอร์มินัลในโฟลเดอร์โปรเจกต์
- ใช้คำสั่ง:
  ```
  streamlit run test.py
  ```
- รอให้ Streamlit เปิดลิงก์เว็บ (เช่น http://localhost:8501)
- เปิดลิงก์ในเว็บเบราว์เซอร์

### 5. ขั้นตอนการใช้งาน
- ทำตามคำแนะนำบนหน้าเว็บเพื่อคาลิเบรตสายตา
- ทดลองควบคุมเมาส์ด้วยสายตา (ถ้าติดตั้ง pyautogui)
- สังเกตผลการคาลิเบรตและค่าความแม่นยำ

### ตัวอย่างค่าที่สามารถปรับแต่งได้ในโปรแกรม

- **จำนวนจุดคาลิเบรต (Calibration Points):** กำหนดจำนวนจุดที่ใช้ในการคาลิเบรตสายตา
- **ขนาดและตำแหน่งจุดคาลิเบรต:** ปรับขนาดหรือรูปแบบการแสดงผลจุดบนหน้าจอ
- **One Euro Filter Parameters:**
  - `mincutoff`, `beta`, `dcutoff` สำหรับปรับความลื่นไหลและลดความสั่นของตำแหน่งสายตา
- **Mouse Controller:**
  - `dwell_ms` (เวลาจ้องเพื่อคลิก)
  - `dwell_radius_px` (รัศมีที่ต้องจ้องนิ่งก่อนคลิก)
  - เปิด/ปิดการควบคุมเมาส์จริง
- **เกณฑ์การผ่านคาลิเบต:**
  - กำหนดค่า RMSE, CV, หรือ Uniformity ที่ต้องผ่านก่อนปลดล็อกการคลิก
- **โหมดการใช้งาน:**
  - เลือกว่าจะใช้เฉพาะการติดตามสายตา หรือควบคุมเมาส์จริงด้วย

**หมายเหตุ:** สามารถปรับค่าต่าง ๆ ได้จาก UI ของ Streamlit หรือแก้ไขในโค้ด `test.py` ตามความเหมาะสมกับการทดลองและอุปกรณ์ที่ใช้

---

**ผู้พัฒนา:** เพื่อการศึกษาและทดลองเท่านั้น
